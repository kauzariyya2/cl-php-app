generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  formLinks FormLink[]
}

model Department {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  questions   Question[]
  formLinks   FormLink[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Question {
  id           Int        @id @default(autoincrement())
  departmentId Int
  questionText String
  type         String     // text, textarea, number, date, select
  options      Json?      // For select type: ["Option 1", "Option 2"]
  required     Boolean    @default(true)
  sortOrder    Int        @default(0)
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([departmentId])
}

model FormLink {
  id           Int          @id @default(autoincrement())
  departmentId Int
  token        String       @unique @db.VarChar(64)
  title        String?
  expiresAt    DateTime?
  createdById  Int?
  department   Department   @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  createdBy    User?        @relation(fields: [createdById], references: [id])
  submissions  Submission[]
  createdAt    DateTime     @default(now())

  @@index([departmentId])
  @@index([token])
}

model Submission {
  id          Int                @id @default(autoincrement())
  formLinkId  Int
  name        String?
  email       String?
  ipAddress   String?
  submittedAt DateTime           @default(now())
  formLink    FormLink           @relation(fields: [formLinkId], references: [id], onDelete: Cascade)
  answers     SubmissionAnswer[]

  @@index([formLinkId])
}

model SubmissionAnswer {
  id           Int        @id @default(autoincrement())
  submissionId Int
  questionId   Int
  answer       Json
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())

  @@index([submissionId])
}
